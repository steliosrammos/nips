This document describes a series of Nostr Events

# NIP-115

## Nostr Translation Bounties

`draft` `optional` `author:steliosrammos`

The Nostr Translation Bounties Protocol defines a series of Nostr events aimed to create a distributed marketplace for requesting and providing translations. This NIP defines the following events:

- `Translation Bounty`
- `Translation Draft`
- `Translation Approval`
- `Translation Payment Request`
- `Translation`


# Terms

- `requestor` - the person who requests the translation
- `validator` - the person who validates the translation
- `translator` - the person who translates the text
- `translator invoice` - the invoice sent by the `translator` to the 
`validator` for the translation
- `validator invoice` - the invoice sent by the `validator` to the `requestor` for the translation
- `validator fee` - the fee charged by the `validator` to the - `requestor` for validating the translation


# Kind 30115 - Translation Bounty

### Event Content:

```json
{
    "id": <event ID>,
    "kind": 30115,
    "pubkey": <requestor pubkey>,
    "content": <text to be translated, format specified by the format tag>,
    "createdAt": <timestamp>,
    "tags": [
        ["a", <unique translation identifier>],
        ["from", <string, ISO 639-1 language code to translate from>],
        ["to", <string, ISO 639-1 language code to translate to>, <validator pubkey (can be added later)>],
        ["amount", <number, in BTCSATS>],
        ["format", <string, format of the text to be translated>],
    ]
}
```

The `Translation Bounty Event` is published by the Requestor.

 - `content`: contains the text to be translated. The format is determined by the `format` tag.
 - `a`: a unique identifier for the translation, as defined by [NIP-33](https://github.com/steliosrammos/nips/blob/master/33.md).
 - `from`: the language of the text to be translated, as an [ISO 639-1](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes) language code.
 - `to`: the event MUST have one or more `to` tags which defines the language(s) to translate to. In order for the bounty to be taken by a `Translator` the `Validator` pubkey MUST be set. However, if a `Validator` is initially not availbale, the bounty can be published without the `Validator` pubkey as a way to advertise the bounty to potential `Validators` as well as `Translators`.
 - `amount`: defines the maximum amount of `BTCSATS` the Requestor is willing to pay for the translation.
 - `format`: defines the format of the text in `content`, and the expected format of the returned translation. The format is defined by the Requestor and can be one of the following:
    - `plaintext`: plain text format
    - `json`: the text is in `JSON` format, following the `i18n JSON v4` format (see [here](https://www.i18next.com/misc/json-format))
    - `po`: the text is in `PO`` format, following the `GNU gettext` format (see [here](https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html))


# Translation Approval Event

### Event Content:

```json
{
    "id": <event ID>,
    "kind": 4,
    "pubkey": <validator pubkey>,
    "content": <empty string>,
    "createdAt": <timestamp>,
    "tags": [
        ["e", <string, approved translation draft event ID>]
        ["status", "approved"]
    ]
}
```

*Note:* other `kind:4` events could be defined to formalise the approval process. Other `statuses` could be introduced such as `rejected` or `change_requested`. This is left for future work.

# Translation Draft Event
```json
{
    "id": <event ID>,
    "kind": 4,
    "pubkey": <translator pubkey>,
    "content": <encrypted JSON of translated text>
    "tags": [
        ["e", <string, translation request event ID>],
        ["to", <string, ISO 639-1 language code translate to>],
        ["p", <validator pubkey, which will be able to decrypt the message>]
    ],
    "ots": <OTS timestamp>
}
```

The `Translation Draft` is a draft translation sent out by the Translator to the Validator, through a private message.

- `content`: contains the encrypted translated text, visible only to the `Validator`, as defined in [NIP-04](https://github.com/nostr-protocol/nips/blob/master/04.md)
- `e`: the ID of the `Translation Bounty Event` that the `Translation Draft` is for.
- `to`: the language of the text to be translated, as an [ISO 639-1](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes) language code.
- `p`: the Validator pubkey, as defined in [NIP-04](https://github.com/nostr-protocol/nips/blob/master/04.md)
- `ots`: the OTS timestamp of the `Translation Draft` event, as defined in [NIP-03](https://github.com/nostr-protocol/nips/blob/master/03.md). Can be used to in case of a dispute to prove the event was published at least as early as the timestamp. Aims to deter abuse where the `Validator` publishes the `Translation Draft` as his own work.


# Translation Payment Request
```json
{
    "id": <event ID>,
    "kind": 4,
    "pubkey": <translator pubkey>,
    "content": <encrypted JSON of payment request>,
    "tags": [
        ["e", <translation request event ID>]
        ["payment_hash", <payment hash of payment request in content>],
        ["p", <validator pubkey, which will be able to decrypt the message>]
    ],
}
```

The payment request from the `Translator` is sent through a private message (or DM) to the `Validator`. 

- `content`: contains the encrypted payment request, visible only to the `Validator`
- `e`: the ID of the `Translation Bounty Event` that the `Translation Draft` is for.
- `payment_hash`: the `payment_hash` of the payment request, as defined in [BOLT11](https://github.com/lightning/bolts/blob/master/11-payment-encoding.md)
- `p`: the `Validator` pubkey

The Validator can decrypt the content to view the payment request and extract the `payment_hash` from it. The same `payment_hash` MUST be used by the Validator to create the HODL invoice for the Requestor.This ensure that the Validator pays out the Translator before claiming the Validation Fee.

*Note:* the `payment_request` is in the encrypted content to avoid letting the Requestor see it. Otherwise, he could pay the `payment_request` to obtain the `preimage` that decrypts the translated text in the `content` of the Translation Event.

# Kind 30116 - Translation Event
```json
{
    "id": <event ID>,
    "kind": 30116,
    "pubkey": <validator pubkey>,
    "content": <JSON of translated text encrypted with secret>
    "tags": [
        ["e", <translation request event ID>],
        ["a", <unique translation identifier>],
        ["to", <ISO 639-1 language code translated to>],
        ["payment_request", <BOLT11 HODL invoice of the Validator (max quote of Translation Request + validator fee)>],
        ["translator", <pubkey of the translator>, <translation DM event ID>],
        ["secret", <128-bit secret, added to the event once the creator pays the validator invoice>]
    ]
}
```

Once the `Translation Draft` is approved by the Validator, he will publish the `Translation Event`. The translated text is added to the `content` field, encrypted by the `preimage` of the `payment_request`. 

- `secret`: the `secret` which the `Requestor` can use to decrypt the content field. It is left empty until the Requestor pays the `payment_request` invoice. Once the Requestor pays the invoice, the `Validator` will pay the `Translator` invoice and add the secret to the `Translation Event`. The Requestor can then decrypt the `content` of the `Translation Event` to obtain the translated text.
- `translator`: the `pubkey` of the `Translator` and the `Translation Draft` event ID.

*Note:* Before paying, the `Requestor` MAY verify that the `payment_request` is correct by verifying that its `payment_hash` matches the `payment_hash` of the `Translation Payment Request` sent by the `Translator`. This ensures the Validator is not trying to cheat by providing a different `payment_request` to the Requestor than the one he received from the Translator.


## Translation Flow

1. The Requestor publishes a `Translation Bounty Event`. For each `to` language tag, he may specify a `Validator` pubkey. If no `Validator` is specified, the `Translation Bounty Event` will have to be updated once a `Validator` is found and accepted by the `Requestor`.
2. The `Translator` finds the `Translation Bounty Event` and publishes a `Translation Draft Event` to the `Validator` specified in the `to` tag.
3. The `Validator` can go through the translation and provide feedback back to the `Translator`. Once the `Validator` validates the `Translation Draft`, he will publish a `Translation Approval` event to the `Translator`.
4. In response, the `Translator` will provide a `payment_request` (aka: `Translator Invoice`) through a `Translation Payment Request` event, sent privately to the `Validator`.
5. The `Validator` MUST use the same `payment_hash` to create a HODL `payment_request` (aka: `Requestor Invoice`). Then, he publishes a `Translation Event`. The `content` field contains the translated text, encrypted with a `secret`. 
6. The `Requestor` pays the `Requestor Invoice`
7. The `Validator` pays the `Translator Invoice` and updates the `Translator Event` to include the `secret`.
8. The `Requestor` decrypts the `content` field of the `Translation Event` to obtain the translated text.

### Visualised

![Protocol Flow](https://cdn.nostr.build/i/e30437b3d98000aed3ee97d710440f303a8a6026b199f5c236e2a4838e333843.png)